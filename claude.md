# SoSpeed - Claude Code向けプロジェクトガイド

## プロジェクト概要
素数の掛け算で構成された数値を素因数分解するスピード練習プログラム。レベル1〜4の難易度選択、2種類の入力方式（スペース区切り/キーボード割り当て）を実装。5問を解き終わるまでの時間を計測。

## ファイル構成
```
sospeed/
├── sospeed.rb           # メインプログラム（Ruby単一ファイル）
├── spec.md              # 詳細仕様書（人間向け）
├── claude.md            # このファイル（AI向けプロジェクトガイド）
├── Dockerfile           # Ruby 3.3イメージ
├── docker-compose.yml   # Docker実行設定
└── .dockerignore        # Docker除外設定
```

## 技術スタック
- **言語**: Ruby 3.3
- **依存関係**: 標準ライブラリのみ（`set`, `io/console`）
- **実行環境**: ローカル（Ruby必須）またはDocker（Ruby不要）

## 実行方法
- **ローカル**: `ruby sospeed.rb`
- **Docker**: `docker compose run --rm sospeed`

## コアクラス: SoSpeed

### 定数
- `PRIMES_BASIC`: [2, 3, 5, 7] - レベル1〜2で使用
- `PRIMES_ADVANCED`: [2, 3, 5, 7, 11] - レベル3〜4で使用
- `QUESTION_COUNT`: 5問固定
- `ERROR_WAIT_TIME`: 2秒（誤答時）
- `KEY_MAPPING`: {'a'=>2, 's'=>3, 'd'=>5, 'f'=>7, 'g'=>11}
- `DIFFICULTY_SETTINGS`: 難易度設定（level1〜level4）

### 主要メソッド
- `select_difficulty`: 難易度選択（レベル1〜4）
- `select_input_mode`: 入力方式選択（スペース区切り/キーボード割り当て）
- `generate_questions`: 問題生成（重複なし、上限チェック）
- `input_with_keyboard_mapping`: キーボード方式の入力処理（Backspace対応）
- `solve_question`: 1問を解く（正解判定、エラーハンドリング）
- `valid_input?`: 入力検証（半角数字とスペースのみ）

## ゲームフロー
1. ルール説明表示
2. 難易度選択（レベル1〜4）
3. 操作方法選択（スペース区切り/キーボード割り当て）
4. 計測開始
5. 5問出題・解答（誤答は再入力）
6. 計測終了・結果表示

## 難易度設定
| レベル | 素数 | 個数 | 上限 |
|--------|------|------|------|
| 1 | 2,3,5,7 | 2個 | 50 |
| 2 | 2,3,5,7 | 3個 | 500 |
| 3 | 2,3,5,7,11 | 4個 | 1000 |
| 4 | 2,3,5,7,11 | 4〜5個 | 10000 |

## 入力方式
1. **スペース区切り**: `2 3 5` + Enterで確定
2. **キーボード割り当て**: aキー→2, sキー→3, dキー→5, fキー→7, gキー→11。リアルタイム表示、Backspace削除可能、Enter確定

## 重要な実装ポイント
- **問題生成**: 同じ素数の重複を許可（例: 2×2×3=12）、5問間での数値重複は禁止
- **正解判定**: 素因数の種類と個数が完全一致（順序不問）
- **エラー処理**: 空白入力は無視、不正文字/不正解は2秒待機後に再入力
- **計測時間**: 難易度選択・操作方法選択の時間は含まない、誤答待機時間は含む
- **インタラクティブ入力**: `io/console`の`getch`を使用（キーボード方式のため）

## Gitコミットに関するルール
- **重要**: gitコミット操作は全てユーザーが実行する
- Claude Codeはコミットメッセージの提案のみを行う
- `git add`、`git commit`、`git push`などのコマンドは実行しない
- ユーザーから「git commitして」と依頼された場合は、コミットメッセージ案を提示するのみ

## コミットメッセージスタイル
過去のコミットメッセージ例：
- "2種類の操作方法選択機能を追加"
- "レベル1〜4の難易度設定機能を追加"
- "Docker環境での実行に対応"

形式：
- 簡潔な日本語
- 機能追加は「〜を追加」形式
- 変更は「〜を変更」形式
- 修正は「〜を修正」形式

## 注意事項
- Gemfileなし（依存関係なし）
- 単一ファイル構成を維持
- 標準ライブラリのみ使用
- Docker環境では`docker compose run`必須（`up`では標準入力が正しく接続されない）
